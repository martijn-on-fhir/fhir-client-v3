<div class="login-container">
  <div class="login-card">
    <!-- Header -->
    <div class="login-header">
      <i class="fas fa-heartbeat brand-icon"></i>
      <h1 class="brand-title">FHIR Client</h1>
    </div>

    <!-- 2FA Verification Screen -->
    @if (show2FAVerification()) {
      <div class="verification-screen">
        <div class="verification-header">
          <i class="fas fa-shield-alt verification-icon"></i>
          <h2>Two-Factor Authentication</h2>
          <p>Enter the 6-digit code from your authenticator app</p>
        </div>

        <form (ngSubmit)="onVerify2FA()">
          <div class="form-group">
            <input
              type="text"
              class="form-control code-input"
              [ngModel]="twoFactorCode()"
              (ngModelChange)="twoFactorCode.set($event)"
              name="code"
              placeholder="000000"
              maxlength="6"
              pattern="[0-9]{6}"
              autocomplete="off"
              autofocus
              required
            />
          </div>

          @if (error()) {
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-circle"></i>
              {{ error() }}
            </div>
          }

          <div class="button-group">
            <button type="button" class="btn btn-secondary" (click)="cancel2FA()" [disabled]="loading()">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="loading() || twoFactorCode().length !== 6">
              @if (loading()) {
                <span class="spinner-border spinner-border-sm"></span>
                Verifying...
              } @else {
                <i class="fas fa-check"></i> Verify
              }
            </button>
          </div>
        </form>
      </div>
    } @else {
      <!-- Login Form Layout -->
      <div class="login-layout">
        <!-- Left: Login Form -->
        <div class="login-form">
          <form (ngSubmit)="onLogin()">
          <!-- Environment Selection -->
          <div class="form-group">
            <label class="form-label" for="environment">
              <i class="fas fa-server"></i> Environment
            </label>
            <select
              id="environment"
              class="form-select"
              [ngModel]="selectedEnvironment()"
              (ngModelChange)="selectedEnvironment.set($event)"
              name="environment"
              required>
              @for (env of availableEnvironments; track env) {
                <option [value]="env">{{ env }}</option>
              }
            </select>
          </div>

          <!-- Client ID -->
          <div class="form-group">
            <label class="form-label" for="clientId">
              <i class="fas fa-id-card"></i> Client ID
            </label>
            <input
              id="clientId"
              type="text"
              class="form-control"
              [ngModel]="clientId()"
              (ngModelChange)="clientId.set($event)"
              name="clientId"
              placeholder="Enter your client ID"
              autocomplete="username"
              required
            />
          </div>

          <!-- Client Secret -->
          <div class="form-group">
            <label class="form-label" for="clientSecret">
              <i class="fas fa-key"></i> Client Secret
            </label>
            <div class="input-group">
              <input
                id="clientSecret"
                [type]="showPassword() ? 'text' : 'password'"
                class="form-control"
                [ngModel]="clientSecret()"
                (ngModelChange)="clientSecret.set($event)"
                name="clientSecret"
                placeholder="Enter your client secret"
                autocomplete="current-password"
                required
              />
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="togglePasswordVisibility()"
              >
                <i class="fas" [class.fa-eye]="!showPassword()" [class.fa-eye-slash]="showPassword()"></i>
              </button>
            </div>
          </div>

          <!-- Save Account -->
          <div class="form-group">
            <div class="form-check">
              <input
                id="saveAccount"
                type="checkbox"
                class="form-check-input"
                [ngModel]="rememberMe()"
                (ngModelChange)="rememberMe.set($event)"
                name="saveAccount"
              />
              <label class="form-check-label" for="saveAccount">
                Account opslaan
              </label>
            </div>
          </div>

          <!-- Account Name (if Save Account is checked) -->
          @if (rememberMe()) {
            <div class="form-group">
              <label class="form-label" for="accountName">
                <i class="fas fa-tag"></i> Naam
              </label>
              <input
                id="accountName"
                type="text"
                class="form-control"
                [ngModel]="accountName()"
                (ngModelChange)="accountName.set($event)"
                name="accountName"
                placeholder="Bijv. Development Account"
                required
              />
            </div>
          }

          <!-- Error Message -->
          @if (error()) {
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-circle"></i>
              {{ error() }}
            </div>
          }

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary btn w-100" [disabled]="loading()">
            @if (loading()) {
              <span class="spinner-border spinner-border-sm"></span>
              Authenticating...
            } @else {
              <i class="fas fa-sign-in-alt"></i> Login
            }
          </button>
          </form>
        </div>

        <!-- Right: Saved Accounts -->
        @if (savedAccounts().length > 0) {
          <div class="saved-accounts">
            <label class="form-label">Saved Accounts</label>
            <div class="account-list">
              @for (account of savedAccounts(); track account.id) {
                <div
                  class="account-item"
                  [class.active]="selectedAccount()?.id === account.id"
                  (click)="selectAccount(account)">
                  <div class="account-info">
                    <i class="fas fa-user-circle account-avatar"></i>
                    <div>
                      <div class="account-name">
                        {{ account.name }}
                        @if (account.autoLogin) {
                          <i class="fas fa-bolt text-warning ms-2" title="Auto-login enabled"></i>
                        }
                      </div>
                      <div class="account-details">
                        {{ account.clientId }} â€¢ {{ account.environment }}
                      </div>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn-remove"
                    (click)="removeSavedAccount($event, account.id)"
                    title="Remove account">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
