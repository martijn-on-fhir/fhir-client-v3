<div class="login-container">
  <div class="login-card">
    <!-- Header -->
    <div class="login-header">
      <i class="fas fa-heartbeat brand-icon"></i>
      <h6 class="brand-title">FHIR Client MX</h6>
    </div>

    <!-- 2FA Verification Screen -->
    @if (show2FAVerification()) {
      <div class="verification-screen">
        <div class="verification-header">
          <i class="fas fa-shield-alt verification-icon"></i>
          <h2>Twee-Factor Authenticatie</h2>
          <p>Voer de 6-cijferige code van je authenticator app in</p>
        </div>

        <form (ngSubmit)="onVerify2FA()">
          <div class="form-group">
            <input
              type="text"
              class="form-control code-input"
              [ngModel]="twoFactorCode()"
              (ngModelChange)="twoFactorCode.set($event)"
              name="code"
              placeholder="000000"
              maxlength="6"
              pattern="[0-9]{6}"
              autocomplete="off"
              autofocus
              required
            />
          </div>

          <div class="button-group">
            <button type="button" class="btn btn-secondary" (click)="cancel2FA()" [disabled]="loading()">
              <i class="fas fa-arrow-left"></i> Terug
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="loading() || twoFactorCode().length !== 6">
              @if (loading()) {
                <span class="spinner-border spinner-border-sm"></span>
                VerifiÃ«ren...
              } @else {
                <i class="fas fa-check"></i> Verifieer
              }
            </button>
          </div>
        </form>
      </div>
    } @else {
      <!-- Server Profiles -->
      <div class="login-content">
        @if (!initialized()) {
          <!-- Loading state -->
          <div class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Laden...</span>
          </div>
        } @else if (profiles().length === 0) {
          <!-- Empty state -->
          <div class="empty-state">
            <i class="fas fa-server empty-icon"></i>
            <h3>Geen servers geconfigureerd</h3>
            <p>Voeg een FHIR server toe om te beginnen</p>
            <button class="btn btn-primary" (click)="openAddProfile()">
              <i class="fas fa-plus"></i> Server toevoegen
            </button>
          </div>
        } @else {
          <!-- Profile List -->
          <div class="profile-section">
            <div class="section-header">
              <label class="section-title">Selecteer een server</label>
              <button class="btn btn-sm btn-outline-primary" (click)="openAddProfile()">
                <i class="fas fa-plus"></i> Toevoegen
              </button>
            </div>

            <div class="profile-list">
              @for (profile of profiles(); track profile.id) {
                <div
                  class="profile-item"
                  [class.selected]="selectedProfileId() === profile.id"
                  (click)="selectProfile(profile)">

                  <!-- Color indicator -->
                  <span class="profile-color" [style.background-color]="profile.color"></span>

                  <!-- Profile info -->
                  <div class="profile-info">
                    <div class="profile-name">
                      {{ profile.name }}
                      @if (profile.isDefault) {
                        <i class="fas fa-star default-badge" title="Standaard server"></i>
                      }
                    </div>
                    <div class="profile-url">{{ profile.fhirServerUrl }}</div>
                  </div>

                  <!-- Auth type badge -->
                  <div class="auth-badge" [title]="getAuthTypeLabel(profile.authType)">
                    <i class="fas {{ getAuthTypeIcon(profile.authType) }}"></i>
                    <span>{{ getAuthTypeLabel(profile.authType) }}</span>
                  </div>

                  <!-- Actions -->
                  <div class="profile-actions">
                    <button
                      class="btn-action"
                      (click)="openEditProfile($event, profile)"
                      title="Bewerken">
                      <i class="fas fa-pen"></i>
                    </button>
                    <button
                      class="btn-action btn-danger"
                      (click)="deleteProfile($event, profile)"
                      title="Verwijderen">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Login Button -->
          <div class="login-actions">
            <button
              class="btn btn-primary btn-login"
              (click)="onLogin()"
              [disabled]="loading() || !selectedProfileId()">
              @if (loading()) {
                <span class="spinner-border spinner-border-sm"></span>
                Verbinden...
              } @else {
                <i class="fas fa-sign-in-alt"></i> Verbinden
              }
            </button>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- Server Profile Dialog -->
<app-server-profile-dialog (profileSaved)="onProfileSaved($event)"></app-server-profile-dialog>
