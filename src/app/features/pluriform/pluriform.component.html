<div class="pluriform-container">
  <!-- Action Bar -->
  <div class="card mb-3 border-0" style="flex-shrink: 0">
    <div class="card-body p-2">
      <div class="row g-3 align-items-end">
        <div class="col-md-10">
          <!-- Future: Add transformation options here -->
        </div>
        <div class="col-md-2">
          <button
            class="btn btn-primary w-100"
            (click)="transform()"
            [disabled]="loading()">
            @if (loading()) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Executing...
            } @else {
              <i class="fas fa-bolt me-2"></i>
              Execute
            }
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-danger" role="alert" style="flex-shrink: 0">
      {{ error() }}
    </div>
  }

  <!-- Results Panel -->
  <div class="card flex-grow-1 d-flex flex-column" style="min-height: 0">
    <div class="card-header d-flex justify-content-between align-items-center" style="flex-shrink: 0">
      <span>XML Transformation</span>
      <small class="text-muted">Drag the divider to resize panels</small>
    </div>

    <div class="card-body flex-grow-1 overflow-hidden p-0" id="pluriform-results-container">
      <div class="d-flex h-100">
        <!-- Left Panel: XML Editor with Syntax Highlighting -->
        <div
          [style.width.%]="leftWidth()"
          [style.min-width.%]="leftWidth()"
          class="h-100 overflow-auto position-relative">

          <!-- Code editor container -->
          <div class="code-editor-container">
            <!-- Hidden textarea for editing -->
            <textarea
              class="code-editor-textarea"
              [value]="leftContent()"
              (input)="onLeftContentChange($event)"
              spellcheck="false"
              [style.background-color]="getEditorBgColor()"
              [style.color]="getEditorTextColor()"
            ></textarea>

            <!-- Syntax highlighting overlay -->
            <pre
              class="code-editor-highlight"
              [style.background-color]="getEditorBgColor()"
              [innerHTML]="highlightedCode()"></pre>
          </div>
        </div>

        <!-- Resizable Divider -->
        <div
          class="resize-divider"
          [class.resizing]="isResizing()"
          (mousedown)="startResizing($event)"
        ></div>

        <!-- Right Panel: Output -->
        <div
          [style.width.%]="100 - leftWidth()"
          [style.min-width.%]="100 - leftWidth()"
          class="h-100">
          <div
            contenteditable="true"
            class="h-100 p-3 overflow-auto output-panel"
            [style.background-color]="getEditorBgColor()"
            [style.color]="getEditorTextColor()"
            [textContent]="rightContent()"
          ></div>
        </div>
      </div>
    </div>
  </div>
</div>
