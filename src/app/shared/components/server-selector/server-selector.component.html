<div class="server-selector">
  <button
    class="selector-button"
    (click)="toggleDropdown($event)"
    title="Server selecteren">
    <span class="status-dot" [style.background-color]="displayColor()"></span>
    <span class="server-name">{{ displayName() }}</span>
    @if (activeProfile()?.fhirVersion) {
      <span class="version-badge">{{ activeProfile()!.fhirVersion }}</span>
    }
    <i class="fas fa-chevron-down chevron" [class.open]="isOpen()"></i>
  </button>

  @if (isOpen()) {
    <div class="dropdown-menu">
      @if (hasProfiles()) {
        <div class="dropdown-section">
          @for (profile of profiles(); track profile.id) {
            <div class="dropdown-item-row">
              <button
                class="dropdown-item"
                [class.active]="profile.id === activeProfileId()"
                [class.switching]="switching() === profile.id"
                (click)="selectProfile(profile, $event)"
                [disabled]="switching() !== null">
                <span
                  class="status-dot"
                  [style.background-color]="profile.color"
                  [class.has-session]="hasValidSession(profile.id)">
                </span>
                <div class="profile-info">
                  <span class="profile-name">{{ profile.name }}</span>
                  <span class="profile-meta">
                    {{ getAuthTypeLabel(profile.authType) }}
                    @if (profile.fhirVersion) {
                      <span class="version-badge-sm">{{ profile.fhirVersion }}</span>
                    }
                  </span>
                </div>
                @if (profile.id === activeProfileId()) {
                  <i class="fas fa-check check-icon"></i>
                }
                @if (switching() === profile.id) {
                  <i class="fas fa-spinner fa-spin spinner-icon"></i>
                }
              </button>
              <button
                class="edit-btn"
                (click)="onEditProfile(profile, $event)"
                title="Bewerken">
                <i class="fas fa-pen"></i>
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="dropdown-empty">
          <i class="fas fa-server"></i>
          <span>Geen servers geconfigureerd</span>
        </div>
      }

      <div class="dropdown-divider"></div>

      <div class="dropdown-actions">
        <button class="dropdown-item action-item" (click)="onAddProfile($event)">
          <i class="fas fa-plus"></i>
          <span>Server toevoegen</span>
        </button>
        <button class="dropdown-item action-item" (click)="onManageProfiles($event)">
          <i class="fas fa-cog"></i>
          <span>Servers beheren</span>
        </button>
      </div>
    </div>
  }
</div>
