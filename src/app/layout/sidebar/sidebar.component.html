<div class="sidebar" [style.width.px]="sidebarWidth()">
  <!-- Sidebar Header with Filter -->
  <div class="sidebar-header">
    <div class="filter-container">
      <i class="fas fa-search filter-icon"></i>
      <input
        type="text"
        class="filter-input"
        placeholder="Filter resources..."
        [(ngModel)]="filterText"
        [value]="filterText()"
        (input)="filterText.set($any($event.target).value)"
      />
      @if (filterText()) {
        <button type="button" class="btn-clear" (click)="clearFilter()" title="Clear filter">
          <i class="fas fa-times"></i>
        </button>
      }
    </div>
  </div>

  <!-- Favorites Section -->
  @if (favorites().length > 0) {
    <div class="favorites-section" [class.expanded]="favoritesExpanded()">
      <button class="section-header" (click)="toggleFavorites()">
        <i class="fas fa-star text-warning"></i>
        <span>Favorites</span>
        <span class="badge bg-secondary">{{ favorites().length }}</span>
        <i class="fas fa-chevron-{{ favoritesExpanded() ? 'up' : 'down' }} ms-auto"></i>
      </button>
      @if (favoritesExpanded()) {
        <ul class="favorites-list">
          @for (fav of favorites(); track fav.id) {
            <li class="favorite-item" (click)="navigateToFavorite(fav)" [title]="fav.query">
              <i class="far fa-{{ fav.resultType === 'single' ? 'file' : 'folder-open' }} favorite-icon "></i>
              <div class="favorite-content">
                <span class="favorite-name">{{ fav.displayName }}</span>
                <span class="favorite-type">{{ fav.resourceType }}</span>
              </div>
              <button class="btn-remove" (click)="removeFavorite(fav, $event)" title="Remove from favorites">
                <i class="fas fa-times"></i>
              </button>
            </li>
          }
        </ul>
      }
    </div>
  }

  <!-- Recent Resources Section -->
  @if (recentResources().length > 0) {
    <div class="recent-section" [class.expanded]="recentExpanded()">
      <button class="section-header" (click)="toggleRecent()">
        <i class="fas fa-clock text-primary"></i>
        <span>Recent</span>
        <span class="badge bg-secondary">{{ recentResources().length }}</span>
        <button class="btn-clear-section" (click)="clearRecent($event)" title="Clear recent">
          <i class="fas fa-trash-alt"></i>
        </button>
        <i class="fas fa-chevron-{{ recentExpanded() ? 'up' : 'down' }} ms-auto"></i>
      </button>
      @if (recentExpanded()) {
        <ul class="recent-list">
          @for (item of recentResources(); track item.id) {
            <li class="recent-item" (click)="navigateToRecent(item)" [title]="item.query">
              <i class="far fa-{{ item.resultType === 'single' ? 'file' : 'folder-open' }} recent-icon  "></i>
              <div class="recent-content">
                <span class="recent-name">{{ item.displayName }}</span>
                <span class="recent-type">{{ item.resourceType }}</span>
              </div>
            </li>
          }
        </ul>
      }
    </div>
  }

  <!-- Resource Types List -->
  <div class="resource-types-section" [class.expanded]="resourceTypesExpanded()">
    <button class="section-header" (click)="toggleResourceTypes()">
      <i class="fas fa-fire text-success"></i>
      <span>FHIR Resources</span>
      @if (!loading() && !error()) {
        <span class="badge bg-secondary">{{ filteredResourceTypes().length }}</span>
      }

      <i class="fas fa-chevron-{{ resourceTypesExpanded() ? 'up' : 'down' }} ms-auto"></i>
    </button>
    @if (resourceTypesExpanded()) {
      <div class="sidebar-content">
        @if (loading()) {
          <div class="loading-state">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p>Loading resource types...</p>
          </div>
        } @else if (error()) {
          <div class="error-state">
            <i class="fas fa-exclamation-triangle"></i>
            <p>{{ error() }}</p>
            <button type="button" class="btn btn-sm btn-primary" (click)="loadResourceTypes()">
              <i class="fas fa-redo"></i> Retry
            </button>
          </div>
        } @else if (filteredResourceTypes().length === 0) {
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <p>No matching resources</p>
          </div>
        } @else {
          <ul class="resource-list">
            @for (resourceType of filteredResourceTypes(); track resourceType) {
              <li class="resource-item" (click)="selectResourceType(resourceType)">
                <i class="far fa-file resource-icon"></i>
                <span class="resource-name">{{ resourceType }}</span>
              </li>
            }
          </ul>
        }
      </div>
    }
  </div>
</div>

<!-- Resize Handle -->
<div
  class="resize-handle"
  [class.resizing]="isResizing()"
  (mousedown)="startResizing($event)"
  title="Drag to resize"
></div>
